local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local SaveManager = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"
))()

local InterfaceManager = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"
))()

local Window = Fluent:CreateWindow({
    Title = "ðŸŽŠ NEW YEARS | Pet Simulator X: Enhanced! ðŸ¾",
    SubTitle = "Tiny Games Premium",
    TabWidth = 160,
    Size = UDim2.fromOffset(850, 580),
    Acrylic = false,
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Auto farm", Icon = "repeat" }),
    Eggs = Window:AddTab({ Title = "Eggs", Icon = "egg" }),
    Index = Window:AddTab({ Title = "Index", Icon = "book" }),
    Machines = Window:AddTab({ Title = "Machines", Icon = "fuel" }),
    Webhooks = Window:AddTab({ Title = "Webhooks", Icon = "mail" }),
    Detected = Window:AddTab({ Title = "Detected features", Icon = "shield-alert" }),
    Misc = Window:AddTab({ Title = "Miscellaneous", Icon = "cog" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

function DecryptRemotes()
    local override = { 
        ["f18"] = "Join Coin",
        ["e11"] = "Farm Coin",
        ["f56"] = "Redeem Free Rewards",
        ["f60"] = "Purchase Area",
        ["f72"] = "Discover Present",
        ["f48"] = "Redeem VIP Rewards",
        ["f16"] = "Buy Egg",
        ["f47"] = "Use Golden Machine",
        ["f12"] = "Redeem Rank Rewards",
        ["e6"] = "Claim Orbs"
    }

    local fi = 0
    local ei = 0
    local foundBuyEgg = false

    for i, remote in pairs(game:GetService("ReplicatedStorage"):GetChildren()) do
        if remote:IsA("RemoteFunction") then
            fi += 1
            local newName = "f"..fi
            
            -- Special handling for Buy Egg - only rename the first one
            if override[newName] == "Buy Egg" then
                if not foundBuyEgg then
                    remote.Name = "Buy Egg"
                    foundBuyEgg = true
                else
                    remote.Name = newName -- Keep it as f16, f17, etc.
                end
            else
                remote.Name = newName
            end
        end
        if remote:IsA("RemoteEvent") then
            ei += 1
            remote.Name = "e"..ei
        end
    end

    for integer, newname in pairs(override) do
        if newname == "Buy Egg" and foundBuyEgg then
            continue -- Skip if we already found Buy Egg
        end
        local remote = game:GetService("ReplicatedStorage"):FindFirstChild(integer)
        if remote and newname and typeof(newname) == "string" then
            remote.Name = newname
        end
    end

    local shareddata = getupvalue(getupvalue(getrawmetatable(require(game:GetService("ReplicatedStorage").Library.Client.Network)).__index,1).Invoke,2)
    local hashstorage = getupvalue(getupvalue(shareddata,2),1)
    local remotestorage = getupvalue(getupvalue(shareddata,1),1)

    for i = 1,#hashstorage do
        for i,v in next, hashstorage[i] do
            hashstorage[v] = i
        end
    end

    for i = 1,#remotestorage do
        for i,v in next, remotestorage[i] do
            if hashstorage[i] then
                v.Name = hashstorage[i]
            end
        end
    end
end

DecryptRemotes()

getgenv().autofarm = false
getgenv().ignorediamonds = false
getgenv().ignorebigchests = false
getgenv().usePrivatePlatform = false
getgenv().sendallpets = false
getgenv().selectedarea = "Town"
getgenv().autoDiamonds = false
getgenv().autoBoosts = false
getgenv().autoVIP = false
getgenv().autoRank = false
getgenv().autoGoldenPets = false
getgenv().noEggAnim = false
getgenv().autoEgg = false
getgenv().autoPetCoin = false
getgenv().collectOrbs = false
getgenv().eggName = "None"
getgenv().eggDelay = 0.5
getgenv().maxOpen = false

local lp = game:GetService("Players").LocalPlayer
local rs = game:GetService("ReplicatedStorage")
local ws = workspace:WaitForChild("__THINGS")
local HttpService = game:GetService("HttpService")

-- Wait a moment for DecryptRemotes to finish
task.wait(0.5)

local redeem = rs:WaitForChild("Redeem Free Rewards")
local redeemVIP = rs:WaitForChild("Redeem VIP Rewards")
local redeemRank = rs:WaitForChild("Redeem Rank Rewards")
local buyEgg = rs:WaitForChild("Buy Egg", 5)
local getEquippedPetsRemote = rs:WaitForChild("Get Equipped Pets")
local joinCoin = rs:WaitForChild("Join Coin")
local farmCoin = rs:WaitForChild("Farm Coin")
local getStatsRemote = rs:WaitForChild("Get Stats")
local goldenMachineRemote = rs:WaitForChild("Use Golden Machine")

-- Debug: Print if we found Buy Egg
if buyEgg then
    print("âœ“ Found Buy Egg remote:", buyEgg:GetFullName())
else
    warn("âœ— Could not find Buy Egg remote!")
    -- Try to find it manually
    for _, remote in pairs(rs:GetChildren()) do
        if remote.Name == "Buy Egg" or (remote.Name:match("^f%d+$") and remote:IsA("RemoteFunction")) then
            print("Found potential Buy Egg:", remote.Name)
        end
    end
end

getgenv().webhookUrl = ""
getgenv().webhooksEnabled = false
getgenv().webhookInterval = 300

local AUTHOR_ICON_URL = "https://i.imgur.com/y2CHUwB.png"

local startStats = nil
local startTime = tick()
local startCoins = 0
local startDiamonds = 0
local trackedHuges = {}
local hugesHatched = 0
local trackedPets = {}
local eggsHatched = 0

pcall(function()
    startStats = getStatsRemote:InvokeServer()
    startCoins = startStats.Coins or 0
    startDiamonds = startStats.Diamonds or 0
    
    if startStats.Pets then
        for _, petData in pairs(startStats.Pets) do
            if petData.uid then
                trackedPets[petData.uid] = true
            end
            if petData.id and string.find(petData.id, "Huge") and petData.uid then
                trackedHuges[petData.uid] = true
            end
        end
    end
end)

local function formatNumber(num)
    if num >= 1e9 then
        return string.format("%.2fB", num/1e9)
    elseif num >= 1e6 then
        return string.format("%.2fM", num/1e6)
    elseif num >= 1e3 then
        return string.format("%.2fK", num/1e3)
    else
        return tostring(num)
    end
end

local function sendWebhook(title, description, color, fields)
    if not getgenv().webhooksEnabled or getgenv().webhookUrl == "" then return end
    
    local embed = {
        title = title,
        color = color or 5793266,
        author = {
            name = "Tiny Games",
            icon_url = AUTHOR_ICON_URL
        },
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
    }
    
    if description then
        embed.description = description
    end
    
    if fields then
        embed.fields = fields
    end
    
    local payload = {
        username = "Tiny Games",
        embeds = {embed}
    }
    
    pcall(function()
        request({
            Url = getgenv().webhookUrl,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode(payload)
        })
    end)
end

local function checkForNewHuges()
    local success, currentStats = pcall(function()
        return getStatsRemote:InvokeServer()
    end)
    
    if not success or not currentStats or not currentStats.Pets then return end
    
    local newHuges = {}
    local newPets = 0
    
    for _, petData in pairs(currentStats.Pets) do
        if petData.uid then
            if not trackedPets[petData.uid] then
                trackedPets[petData.uid] = true
                newPets = newPets + 1
            end
        end
        
        if petData.id and string.find(petData.id, "Huge") and petData.uid then
            if not trackedHuges[petData.uid] then
                trackedHuges[petData.uid] = true
                hugesHatched = hugesHatched + 1
                table.insert(newHuges, petData.id)
            end
        end
    end
    
    eggsHatched = eggsHatched + newPets
    
    if #newHuges > 0 then
        local hugeName = newHuges[1]
        local fields = {
            { name = "Player", value = lp.Name, inline = true },
            { name = "Pet Name", value = hugeName, inline = true },
            { name = "Total Huges Hatched", value = tostring(hugesHatched), inline = true }
        }
        
        sendWebhook("ðŸŽ‰ HUGE PET HATCHED! ðŸŽ‰", "Congratulations on hatching a huge pet!", 15844367, fields)
        
        Fluent:Notify({
            Title = "Huge Pet Hatched!",
            Content = hugeName .. " has been logged to webhook!",
            Duration = 5
        })
    end
end

local function sendSessionStats()
    if not getgenv().webhooksEnabled then return end
    
    local success, currentStats = pcall(function()
        return getStatsRemote:InvokeServer()
    end)
    
    if not success or not currentStats then return end
    
    local coins = currentStats.Coins or 0
    local diamonds = currentStats.Diamonds or 0
    local uptimeMinutes = math.floor((tick() - startTime) / 60)
    local sessionGainCoins = coins - startCoins
    local sessionGainDiamonds = diamonds - startDiamonds
    
    local fields = {
        { name = "Player", value = lp.Name, inline = true },
        { name = "Coins", value = formatNumber(coins), inline = true },
        { name = "Diamonds", value = formatNumber(diamonds), inline = true },
        { name = "Uptime", value = uptimeMinutes .. " mins", inline = true },
        { name = "Session Gain", 
          value = string.format("+%s Coins / +%s Diamonds", 
              formatNumber(sessionGainCoins), formatNumber(sessionGainDiamonds)), 
          inline = true },
        { name = "Eggs Hatched", value = tostring(eggsHatched), inline = true },
        { name = "Huges Hatched", value = tostring(hugesHatched), inline = true }
    }
    
    sendWebhook("Player Session Stats", nil, 5793266, fields)
end

local function webhookLoop()
    if not getgenv().webhooksEnabled then 
        task.delay(5, webhookLoop)
        return 
    end
    
    sendSessionStats()
    task.delay(getgenv().webhookInterval, webhookLoop)
end

local function hugePetCheckLoop()
    while true do
        if getgenv().webhooksEnabled then
            checkForNewHuges()
        end
        task.wait(2)
    end
end

task.spawn(hugePetCheckLoop)

local function diamondsLoop()
    if not getgenv().autoDiamonds then return end
    pcall(function() redeem:InvokeServer("Diamonds") end)
    task.delay(1, diamondsLoop)
end

local function orbsLoop()
    if not getgenv().collectOrbs then return end
    pcall(function()
        local allorbs = {}
        for i, v in pairs(workspace.__THINGS.Orbs:GetChildren()) do
            table.insert(allorbs, v.Name)
        end

        if #allorbs > 0 then
            game:GetService("ReplicatedStorage"):WaitForChild("Claim Orbs"):FireServer(allorbs)
        end
    end)
    task.delay(1, orbsLoop)
end

local function boostsLoop()
    if not getgenv().autoBoosts then return end
    pcall(function() redeem:InvokeServer("Boosts") end)
    task.delay(1, boostsLoop)
end

local function vipLoop()
    if not getgenv().autoVIP then return end
    pcall(function() redeemVIP:InvokeServer() end)
    task.delay(1, vipLoop)
end

local function rankLoop()
    if not getgenv().autoRank then return end
    pcall(function() redeemRank:InvokeServer() end)
    task.delay(1, rankLoop)
end

local eggPadsLoop = nil
local originalPosition = nil
local hasTeleportedToEgg = false

local function findEggLocation(eggName)
    for _, eggPath in ipairs({
        "1 | Town Center", "2 | Gloomy Jungle", "3 | Autumn Forest", "4 | Sandy Beachside",
        "5 | Mystical Mines", "6 | Snowy Town", "7 | Icicle Peaks", "8 | Cold Woods",
        "9 | Desert Wild West", "10 | Magmatic Meadows", "11 | Volcanic Fault", "12 | Crystal Cavern",
        "Secret | Dominus Frigidus Egg", "Secret | Dominus Infernus Egg", "Secret | Starry Dominus Egg"
    }) do
        local eggLocation = workspace.__MAP.Eggs:FindFirstChild(eggPath)
        if eggLocation then
            local eggsFolder = eggLocation:FindFirstChild("Eggs")
            if eggsFolder then
                for _, child in pairs(eggsFolder:GetChildren()) do
                    if child.Name == "Egg Capsule" then
                        local eggID = child:GetAttribute("ID")
                        if eggID == eggName then
                            local eggMesh = child:FindFirstChild("Egg")
                            if eggMesh and eggMesh:IsA("BasePart") then
                                return eggMesh.Position
                            end
                        end
                    end
                end
            end
        end
    end
    return nil
end

local function teleportToEgg()
    if getgenv().eggName == "None" or hasTeleportedToEgg then return end
    
    local success = pcall(function()
        local char = lp.Character
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        
        local eggPos = findEggLocation(getgenv().eggName)
        if eggPos then
            hrp.CFrame = CFrame.new(eggPos + Vector3.new(0, 3, 0))
            hasTeleportedToEgg = true
            print("Teleported to egg:", getgenv().eggName)
        else
            print("ERROR: Could not find egg location for:", getgenv().eggName)
        end
    end)
    
    if not success then
        print("ERROR: Teleport failed")
        hasTeleportedToEgg = false
    end
end

local lastPetCount = 0

local function eggLoop()
    -- Initialize pet count on first run
    if lastPetCount == 0 then
        pcall(function()
            local stats = getStatsRemote:InvokeServer()
            if stats and stats.Pets then
                for _ in pairs(stats.Pets) do
                    lastPetCount = lastPetCount + 1
                end
            end
        end)
    end
    
    while getgenv().autoEgg do
        if getgenv().eggName == "None" then 
            task.wait(1)
            continue
        end
        
        -- Teleport once if we haven't already
        if not hasTeleportedToEgg then
            teleportToEgg()
            task.wait(1) -- Wait for teleport to complete
        end
        
        -- Hatch the egg
        local success = pcall(function() 
            buyEgg:InvokeServer(
                getgenv().eggName,
                false,
                getgenv().maxOpen
            )
        end)
        
        if success then
            print("Hatching egg:", getgenv().eggName)
        else
            print("Failed to hatch egg")
        end
        
        task.wait(getgenv().eggDelay)
    end
    
    hasTeleportedToEgg = false
    print("Egg hatching stopped")
end

local function toggleEggAnim(state)
    pcall(function()
        local eggScript = lp.PlayerScripts
            :WaitForChild("Scripts")
            :WaitForChild("Game")
            :WaitForChild("Main")
            :WaitForChild("Eggs")
            :WaitForChild("Egg Opening Frontend")
        eggScript.Disabled = state
    end)
end

local function getEquippedPets()
    local ok, pets = pcall(function() return getEquippedPetsRemote:InvokeServer() end)
    if not ok then return {} end
    local ids = {}
    for _, p in ipairs(pets) do
        ids[#ids + 1] = p.uid
    end
    return ids
end

local function farmPets(coin)
    if not getgenv().autoPetCoin then return end
    for _, petId in ipairs(getEquippedPets()) do
        if not getgenv().autoPetCoin then break end
        pcall(function() farmCoin:FireServer(coin, petId) end)
        task.wait(0.1)
    end
    task.delay(0.1, function()
        if getgenv().autoPetCoin then
            farmPets(coin)
        end
    end)
end

local function sendPets()
    if not getgenv().autoPetCoin then return end
    local coin = ws.Coins:GetChildren()[1]
    if not coin then
        task.delay(1, sendPets)
        return
    end
    local pets = getEquippedPets()
    if #pets == 0 then
        task.delay(1, sendPets)
        return
    end
    pcall(function() joinCoin:InvokeServer(coin.Name, pets) end)
    farmPets(coin.Name)
    task.delay(1, sendPets)
end

local function goldenPetsLoop()
    if not getgenv().autoGoldenPets then return end
    local success, stats = pcall(function() return getStatsRemote:InvokeServer() end)
    if success and stats and stats.Pets then
        local ids = {}
        for _, petData in pairs(stats.Pets) do
            if petData.id == "Holiday Owl" and petData.uid then
                table.insert(ids, petData.uid)
            end
        end
        if #ids > 0 then
            for i = #ids, 2, -1 do
                local j = math.random(i)
                ids[i], ids[j] = ids[j], ids[i]
            end
            local args = {}
            for i = 1, math.min(6, #ids) do
                args[i] = ids[i]
            end
            pcall(function() goldenMachineRemote:InvokeServer(args) end)
        end
    end
    task.delay(1, goldenPetsLoop)
end

local autofarmRunning = false
local currentPlatform = nil
local currentTargetPos = nil
local needsReset = false
local guiInitialized = false

local function getAreaGroundInfo(areaName)
    local ws = game:GetService("Workspace")
    local areaPath = ws.__MAP.Areas[areaName]
    
    if areaName == "Volcanic Fault" then
        local ground = areaPath.Ground.Union
        return { part = ground, position = ground.Position }
    elseif areaName == "Sandy Beachside" then
        local ground = areaPath.Ground
        return { part = ground, position = Vector3.new(-843.622009, 89.2281799, -2779.57617) }
    else
        local ground = areaPath.Ground
        return { part = ground, position = ground.Position }
    end
end

task.spawn(function()
    pcall(function()
        local iciclePeaks = game:GetService("Workspace").__MAP.Areas:FindFirstChild("Icicle Peaks")
        if iciclePeaks then
            for _, obj in pairs(iciclePeaks:GetDescendants()) do
                if obj:IsA("MeshPart") and obj.Name == "Rock" then
                    obj:Destroy()
                end
            end
            print("Deleted all rocks in Icicle Peaks")
        end
    end)
end)

local function teleportToPosition(position)
    local players = game:GetService("Players")
    local player = players.LocalPlayer
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    hrp.CFrame = CFrame.new(position)
end

local function updatePosition()
    if not guiInitialized then return end
    
    pcall(function()
        local areaInfo = getAreaGroundInfo(getgenv().selectedarea)
        
        if currentPlatform then
            currentPlatform:Destroy()
            currentPlatform = nil
        end
        
        needsReset = true
        
        if getgenv().usePrivatePlatform then
            local ws = game:GetService("Workspace")
            local platformPos = areaInfo.position - Vector3.new(0, 10, 0)
            local privatePlatform = Instance.new("Part")
            privatePlatform.Size = Vector3.new(15, 1, 15)
            privatePlatform.Anchored = true
            privatePlatform.CanCollide = true
            privatePlatform.Transparency = 0.5
            privatePlatform.Position = platformPos
            privatePlatform.Name = "PrivatePlatform"
            privatePlatform.Parent = ws
            currentPlatform = privatePlatform
            
            currentTargetPos = platformPos + Vector3.new(0, 3, 0)
            teleportToPosition(currentTargetPos)
        else
            currentTargetPos = areaInfo.position + Vector3.new(0, 3, 0)
            teleportToPosition(currentTargetPos)
        end
    end)
end

local function startAutofarm()
    if autofarmRunning then return end
    autofarmRunning = true
    
    task.spawn(function()
        updatePosition()
    end)
    
    task.spawn(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/YoProMan/PetSimulatorXEnhancedRemoteDecryptor/refs/heads/main/decryptor", true))()
        
        local ws = game:GetService("Workspace")
        local rs = game:GetService("ReplicatedStorage")
        local players = game:GetService("Players")

        local player = players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        local getpets = rs:WaitForChild("Get Equipped Pets")
        local joincoin = rs:WaitForChild("Join Coin")
        local farmcoin = rs:WaitForChild("Farm Coin")

        local coinfolder = ws.__THINGS:WaitForChild("Coins")

        local radius = 190
        local clickdelayMin = 0.01
        local clickdelayMax = 0.05
        local joinintervalMin = 0.08
        local joinintervalMax = 0.15
        local scansleepMin = 0.15
        local scansleepMax = 0.25

        local function randomDelay(min, max)
            return min + math.random() * (max - min)
        end

        local diamondtextures = {
            "rbxassetid://13087826956",
            "rbxassetid://13087701741",
        }

        local bigchesttextures = {
            "rbxassetid://17686694402",
        }

        local function shouldignore(texture)
            if getgenv().ignorediamonds and table.find(diamondtextures, texture) then
                return true
            end
            
            if getgenv().ignorebigchests and table.find(bigchesttextures, texture) then
                return true
            end
            
            return false
        end

        local petAssignments = {}
        local joinedCoins = {}
        local clickedCoins = {}
        local farmedCoins = {}
        local cachedCoins = {}
        local lastScan = 0
        local coinsDeleted = 0
        local breakThreshold = 60
        local breakMin = 3
        local breakMax = 5

        while getgenv().autofarm do
            if not currentTargetPos then
                task.wait(0.5)
                continue
            end
            
            if needsReset then
                table.clear(petAssignments)
                table.clear(joinedCoins)
                table.clear(clickedCoins)
                table.clear(farmedCoins)
                table.clear(cachedCoins)
                coinsDeleted = 0
                needsReset = false
                print("Reset all pet assignments for new area")
            end
            
            local now = os.clock()
            local ok, pets = pcall(function() return getpets:InvokeServer() end)
            if not ok or not pets or #pets == 0 then
                task.wait(randomDelay(0.1, 0.2))
                continue
            end

            local nextScanDelay = randomDelay(scansleepMin, scansleepMax)
            if now - lastScan >= nextScanDelay then
                table.clear(cachedCoins)
                local basePos = currentTargetPos
                
                for coin, _ in pairs(joinedCoins) do
                    if not coin.Parent then
                        coinsDeleted += 1
                        joinedCoins[coin] = nil
                        clickedCoins[coin] = nil
                        farmedCoins[coin] = nil
                    end
                end
                
                for petUid, assignedCoin in pairs(petAssignments) do
                    if not assignedCoin.Parent then
                        petAssignments[petUid] = nil
                    end
                end
                
                if coinsDeleted >= breakThreshold then
                    local breakTime = randomDelay(breakMin, breakMax)
                    print(string.format("Taking a break for %.2f seconds after %d coins...", breakTime, coinsDeleted))
                    task.wait(breakTime)
                    coinsDeleted = 0
                end
                
                for _, model in ipairs(coinfolder:GetChildren()) do
                    local coin = model:FindFirstChild("Coin")
                    if coin and coin:IsA("MeshPart") and not joinedCoins[model] and not shouldignore(coin.TextureID) and (coin.Position - basePos).Magnitude <= radius then
                        cachedCoins[#cachedCoins + 1] = model
                    end
                end
                lastScan = now
            end

            if getgenv().sendallpets then
                local targetCoin = cachedCoins[1]
                if targetCoin and not joinedCoins[targetCoin] then
                    for _, pet in ipairs(pets) do
                        if not petAssignments[pet.uid] then
                            task.wait(randomDelay(0.01, 0.05))
                            
                            local success = pcall(function() joincoin:InvokeServer(targetCoin.Name, { pet.uid }) end)

                            if success then
                                joinedCoins[targetCoin] = true
                                petAssignments[pet.uid] = targetCoin

                                if not farmedCoins[targetCoin] then
                                    task.wait(randomDelay(0.02, 0.06))
                                    pcall(function() farmcoin:FireServer(targetCoin.Name, pet.uid) end)
                                    farmedCoins[targetCoin] = true
                                end

                                if not clickedCoins[targetCoin] then
                                    clickedCoins[targetCoin] = true
                                    local cd = targetCoin.Coin:FindFirstChildOfClass("ClickDetector")
                                    if cd then
                                        local clickDelay = randomDelay(clickdelayMin, clickdelayMax)
                                        task.delay(clickDelay, function() pcall(fireclickdetector, cd) end)
                                    end
                                end
                            end
                        end
                    end
                end
            else
                local coinIndex = 1
                for _, pet in ipairs(pets) do
                    if not petAssignments[pet.uid] and cachedCoins[coinIndex] then
                        local model = cachedCoins[coinIndex]
                        local coin = model:FindFirstChild("Coin")
                        if not coin or joinedCoins[model] then
                            coinIndex += 1
                            continue
                        end

                        task.wait(randomDelay(joinintervalMin, joinintervalMax))

                        local success = pcall(function() joincoin:InvokeServer(model.Name, { pet.uid }) end)

                        if success then
                            joinedCoins[model] = true
                            petAssignments[pet.uid] = model

                            if not farmedCoins[model] then
                                task.wait(randomDelay(0.02, 0.06))
                                pcall(function() farmcoin:FireServer(model.Name, pet.uid) end)
                                farmedCoins[model] = true
                            end

                            if not clickedCoins[model] then
                                clickedCoins[model] = true
                                local cd = coin:FindFirstChildOfClass("ClickDetector")
                                if cd then
                                    local clickDelay = randomDelay(clickdelayMin, clickdelayMax)
                                    task.delay(clickDelay, function() pcall(fireclickdetector, cd) end)
                                end
                            end
                        end

                        coinIndex += 1
                    end
                end
            end

            task.wait(randomDelay(0.08, 0.15))
        end
        
        autofarmRunning = false
    end)
end

Tabs.Main:AddToggle("AutoFarm", {
    Title = "Auto farm",
    Default = false
}):OnChanged(function(value)
    getgenv().autofarm = value
    if value then
        guiInitialized = true
        startAutofarm()
    end
end)

Tabs.Main:AddToggle("UsePrivatePlatform", {
    Title = "Use Private Platform",
    Default = false
}):OnChanged(function(value)
    getgenv().usePrivatePlatform = value
    guiInitialized = true
    updatePosition()
    if value then
        Fluent:Notify({
            Title = "Private Platform",
            Content = "Platform created below ground",
            Duration = 2
        })
    else
        Fluent:Notify({
            Title = "Private Platform",
            Content = "Platform removed",
            Duration = 2
        })
    end
end)

Tabs.Main:AddToggle("SendAllPets", {
    Title = "Send all pets",
    Default = false
}):OnChanged(function(value)
    getgenv().sendallpets = value
end)

Tabs.Main:AddToggle("IgnoreBigChests", {
    Title = "Ignore Big Chests",
    Default = false
}):OnChanged(function(value)
    getgenv().ignorebigchests = value
end)

Tabs.Main:AddToggle("IgnoreDiamonds", {
    Title = "Ignore Diamonds",
    Default = false
}):OnChanged(function(value)
    getgenv().ignorediamonds = value
end)

Tabs.Main:AddToggle("CollectOrbs", {
    Title = "Collect orbs",
    Default = false
}):OnChanged(function(value)
    getgenv().collectOrbs = value
    if value then orbsLoop() end
end)

Tabs.Main:AddParagraph({
    Title = "Free rewards",
    Content = ""
})

Tabs.Main:AddToggle("AutoDiamonds", {
    Title = "Auto Diamond rewards",
    Default = false
}):OnChanged(function(value)
    getgenv().autoDiamonds = value
    if value then diamondsLoop() end
end)

Tabs.Main:AddToggle("AutoVIP", {
    Title = "Auto VIP rewards",
    Default = false
}):OnChanged(function(value)
    getgenv().autoVIP = value
    if value then vipLoop() end
end)

Tabs.Main:AddToggle("AutoRank", {
    Title = "Auto Rank rewards",
    Default = false
}):OnChanged(function(value)
    getgenv().autoRank = value
    if value then rankLoop() end
end)

Tabs.Main:AddParagraph({
    Title = "Select Area",
    Content = ""
})

local Dropdown = Tabs.Main:AddDropdown("SpawnWorld", {
    Title = "Spawn World",
    Values = {
        "Town", "Forest", "Autumn Forest", "Sandy Beachside", "Mystical Mine",
        "Snowy Town", "Icicle Peaks", "Cold Woods", "Desert Wild West",
        "Magmatic Meadows", "Volcanic Fault", "Crystal Cavern"
    },
    Multi = false,
    Default = 1
})

Dropdown:SetValue("Town")

Dropdown:OnChanged(function(Value)
    getgenv().selectedarea = Value
    guiInitialized = true
    updatePosition()
    Fluent:Notify({
        Title = "Area Changed",
        Content = "Tweening to " .. Value,
        Duration = 2
    })
end)

local EggStatsParagraph = nil

local function updateEggStatsParagraph()
    if not EggStatsParagraph then 
        print("EggStatsParagraph not ready yet")
        return 
    end
    
    local success, err = pcall(function()
        local newText = "Eggs Hatched: " .. tostring(eggsHatched)
        print("Attempting to update paragraph to:", newText)
        
        if EggStatsParagraph.SetDesc then
            print("Using SetDesc method")
            EggStatsParagraph:SetDesc(newText)
        elseif EggStatsParagraph.SetContent then
            print("Using SetContent method")
            EggStatsParagraph:SetContent(newText)
        elseif EggStatsParagraph.Set then
            print("Using Set method")
            EggStatsParagraph:Set(newText)
        else
            print("Using direct Content assignment")
            EggStatsParagraph.Content = newText
        end
        print("Paragraph updated successfully")
    end)
    
    if not success then
        warn("Failed to update paragraph:", err)
    end
end

EggStatsParagraph = Tabs.Eggs:AddParagraph({
    Title = "Statistics",
    Content = "Eggs Hatched: 0"
})

print("EggStatsParagraph created:", EggStatsParagraph ~= nil)

task.spawn(function()
    task.wait(1) -- Wait a moment for everything to initialize
    while true do
        updateEggStatsParagraph()
        task.wait(1)
    end
end)

Tabs.Eggs:AddToggle("AutoEgg", {
    Title = "Auto Hatch",
    Default = false
}):OnChanged(function(value)
    getgenv().autoEgg = value
    hasTeleportedToEgg = false
    if value then 
        eggLoop()
    end
end)

local HatchingDropdown = Tabs.Eggs:AddDropdown("HatchingMode", {
    Title = "Hatching Mode",
    Values = {"Single", "Max"},
    Multi = false,
    Default = 1,
})

HatchingDropdown:SetValue("Single")

HatchingDropdown:OnChanged(function(Value)
    if Value == "Max" then
        getgenv().maxOpen = true
    else
        getgenv().maxOpen = false
    end
end)

local EggDelaySlider = Tabs.Eggs:AddSlider("EggDelay", {
    Title = "Egg Opening Delay (seconds)",
    Description = "Delay between each egg opening",
    Default = 0.5,
    Min = 0.3,
    Max = 1,
    Rounding = 1
})

EggDelaySlider:OnChanged(function(Value)
    getgenv().eggDelay = Value
end)

Tabs.Eggs:AddParagraph({
    Title = "Extra",
    Content = ""
})

Tabs.Eggs:AddToggle("NoEggAnim", {
    Title = "Remove Egg Animation",
    Default = false
}):OnChanged(function(value)
    getgenv().noEggAnim = value
    toggleEggAnim(value)
end)

Tabs.Eggs:AddToggle("RemoveEggNotifications", {
    Title = "Remove Egg Notifications",
    Default = false
}):OnChanged(function()
    
end)

Tabs.Eggs:AddParagraph({
    Title = "Egg Selection",
    Content = ""
})

local NormalEggsDropdown = Tabs.Eggs:AddDropdown("NormalEggs", {
    Title = "Normal Eggs",
    Values = {
        "None", "Paw Egg", "Bloomy Egg", "Grassy Egg", "Overgrown Egg", "Wooden Egg", 
        "Chestnut Egg", "Beach Ball Egg", "Submerged Flower Egg", "Relic Egg", 
        "Geode Egg", "Snowy Egg", "Cracked Ice Egg", "Frozen Egg", "Icicle Egg", 
        "Melting Egg", "Striped Egg", "Fossil Egg", "Ancient Egg", "Magma Egg", 
        "Fiery Metal Egg", "Volcanic Egg", "Crystalized Egg", "Jewel Enclosure Egg", 
        "Dominus Frigidus Egg", "Dominus Infernus Egg", "Starry Dominus Egg"
    },
    Multi = false,
    Default = 1,
})

NormalEggsDropdown:SetValue("None")

NormalEggsDropdown:OnChanged(function(Value)
    getgenv().eggName = Value
    hasTeleportedToEgg = false
    Fluent:Notify({
        Title = "Egg Selected",
        Content = Value,
        Duration = 2
    })
end)

local GoldenEggsDropdown = Tabs.Eggs:AddDropdown("GoldenEggs", {
    Title = "Golden Eggs",
    Values = {
        "None", "Golden Paw Egg", "Golden Bloomy Egg", "Golden Grassy Egg", "Golden Overgrown Egg", 
        "Golden Wooden Egg", "Golden Chestnut Egg", "Golden Beach Ball Egg", 
        "Golden Submerged Flower Egg", "Golden Relic Egg", "Golden Geode Egg", 
        "Golden Snowy Egg", "Golden Cracked Ice Egg", "Golden Frozen Egg", 
        "Golden Icicle Egg", "Golden Melting Egg", "Golden Striped Egg", 
        "Golden Fossil Egg", "Golden Ancient Egg", "Golden Magma Egg", 
        "Golden Fiery Metal Egg", "Golden Volcanic Egg", "Golden Crystalized Egg", 
        "Golden Jewel Enclosure Egg", "Golden Dominus Frigidus Egg", 
        "Golden Dominus Infernus Egg", "Golden Starry Dominus Egg"
    },
    Multi = false,
    Default = 1,
})

GoldenEggsDropdown:SetValue("None")

GoldenEggsDropdown:OnChanged(function(Value)
    getgenv().eggName = Value
    hasTeleportedToEgg = false
    Fluent:Notify({
        Title = "Golden Egg Selected",
        Content = Value,
        Duration = 2
    })
end)

Tabs.Eggs:AddParagraph({
    Title = "Other",
    Content = ""
})

Tabs.Eggs:AddToggle("AccurateOdds", {
    Title = "Accurate Odds",
    Default = false
}):OnChanged(function()
    
end)

Tabs.Misc:AddButton({
    Title = "Unlock All Presents",
    Description = "Collect all the presents in the game",
    Callback = function()
        for i = 1, 25, 1 do
            game:GetService("ReplicatedStorage")["Discover Present"]:InvokeServer(i)
        end
        for i, v in pairs(workspace.__MAP.Interactive.Presents) do
            v:Destroy()
        end
    end
})

Tabs.Machines:AddToggle("AutoGoldenPets", {
    Title = "Auto Golden Pets",
    Default = false
}):OnChanged(function(value)
    getgenv().autoGoldenPets = value
    if value then goldenPetsLoop() end
end)

local Input = Tabs.Webhooks:AddInput("WebhookURL", {
    Title = "Webhook URL",
    Default = "",
    Placeholder = "Paste Discord Webhook URL",
    Numeric = false,
    Finished = false,
    Callback = function(Value)
        getgenv().webhookUrl = Value
    end
})

Tabs.Webhooks:AddButton({
    Title = "Test Webhook",
    Description = "Send a test message to verify connection",
    Callback = function()
        if getgenv().webhookUrl == "" then
            Fluent:Notify({
                Title = "Error",
                Content = "Please enter a webhook URL first!",
                Duration = 3
            })
            return
        end
        
        sendWebhook("Test Webhook", "If you see this, your webhook is working! âœ…", 5763719)
        
        Fluent:Notify({
            Title = "Success",
            Content = "Test webhook sent!",
            Duration = 3
        })
    end
})

Tabs.Webhooks:AddToggle("EnableWebhooks", {
    Title = "Enable Webhooks",
    Default = false
}):OnChanged(function(value)
    getgenv().webhooksEnabled = value
    if value then 
        webhookLoop()
        Fluent:Notify({
            Title = "Webhooks Enabled",
            Content = "Session stats will be sent every " .. (getgenv().webhookInterval/60) .. " minutes",
            Duration = 4
        })
    end
end)

local IntervalSlider = Tabs.Webhooks:AddSlider("WebhookInterval", {
    Title = "Update Interval (minutes)",
    Description = "How often to send session stats",
    Default = 5,
    Min = 1,
    Max = 60,
    Rounding = 0
})

IntervalSlider:OnChanged(function(Value)
    getgenv().webhookInterval = Value * 60
end)

Tabs.Webhooks:AddParagraph({
    Title = "Webhook Info",
    Content = "Session stats include: Player name, coins, diamonds, uptime, session gains, EGGS HATCHED, and HUGE PETS HATCHED. Updates automatically at your chosen interval."
})

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})

InterfaceManager:SetFolder("TinyGames")
SaveManager:SetFolder("TinyGames/configs")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)
SaveManager:LoadAutoloadConfig()

Fluent:Notify({
    Title = "Tiny Games",
    Content = "Loaded successfully!",
    Duration = 4
})

guiInitialized = true
